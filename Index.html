<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OpenAI Jobs Dashboard - San Francisco</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f8f9fa;
            color: #333;
            line-height: 1.6;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 40px 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
        }

        .header h1 {
            font-size: 2.5rem;
            font-weight: 400;
            color: #1a1a1a;
            margin-bottom: 10px;
        }

        .header p {
            color: #666;
            font-size: 1.1rem;
        }

        .controls {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 30px;
            display: flex;
            align-items: center;
            gap: 20px;
            flex-wrap: wrap;
        }

        .control-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .control-group label {
            font-weight: 500;
            color: #555;
            white-space: nowrap;
        }

        .control-group select {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            background: white;
            cursor: pointer;
        }

        .control-group select:focus {
            outline: none;
            border-color: #007bff;
        }

        .stats {
            text-align: center;
            margin-bottom: 20px;
            color: #666;
            font-size: 0.95rem;
        }

        .jobs-table {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .table-header {
            background: #f8f9fa;
            padding: 15px 20px;
            border-bottom: 1px solid #e9ecef;
            font-weight: 600;
            color: #495057;
            display: grid;
            grid-template-columns: 100px 60px 300px 150px 150px 120px 120px 150px 100px;
            gap: 15px;
            font-size: 0.9rem;
            align-items: center;
        }

        .job-row {
            padding: 18px 20px;
            border-bottom: 1px solid #f1f3f4;
            display: grid;
            grid-template-columns: 100px 60px 300px 150px 150px 120px 120px 150px 100px;
            gap: 15px;
            align-items: center;
            transition: background-color 0.2s ease;
        }

        .job-row:hover {
            background-color: #f8f9fa;
        }

        .job-row:last-child {
            border-bottom: none;
        }

        .job-row.closed {
            opacity: 0.7;
            background-color: #fff5f5;
        }

        .date-listed {
            color: #666;
            font-size: 0.9rem;
        }

        .days-since {
            font-weight: 500;
            padding: 4px 8px;
            border-radius: 4px;
            text-align: center;
            font-size: 0.85rem;
        }

        .days-new {
            background: #d4edda;
            color: #155724;
        }

        .days-normal {
            background: #fff3cd;
            color: #856404;
        }

        .days-urgent {
            background: #f8d7da;
            color: #721c24;
        }

        .job-title {
            font-weight: 500;
            color: #1a1a1a;
        }

        .job-title.closed::after {
            content: " (CLOSED)";
            color: #dc3545;
            font-size: 0.8rem;
            font-weight: normal;
        }

        .team, .department {
            color: #666;
            font-size: 0.9rem;
        }

        .salary {
            color: #495057;
            font-weight: 500;
        }

        .location {
            color: #666;
            font-size: 0.9rem;
        }

        .apply-link {
            background: #007bff;
            color: white;
            padding: 8px 16px;
            border-radius: 4px;
            text-decoration: none;
            font-size: 0.85rem;
            font-weight: 500;
            transition: background-color 0.2s ease;
            text-align: center;
        }

        .apply-link:hover {
            background: #0056b3;
            text-decoration: none;
            color: white;
        }

        .apply-link.closed {
            background: #6c757d;
            cursor: not-allowed;
        }

        .loading {
            text-align: center;
            padding: 60px;
            color: #666;
        }

        .no-results {
            text-align: center;
            padding: 60px;
            color: #666;
        }

        .last-updated {
            text-align: center;
            color: #666;
            font-size: 0.9rem;
            margin-top: 20px;
        }

        @media (max-width: 1400px) {
            .table-header,
            .job-row {
                grid-template-columns: 90px 50px 250px 130px 130px 100px 100px 130px 90px;
                gap: 10px;
                font-size: 0.85rem;
            }
        }

        @media (max-width: 1200px) {
            .table-header,
            .job-row {
                grid-template-columns: 1fr;
                gap: 5px;
                text-align: left;
            }
            
            .job-row {
                padding: 20px;
                border-left: 4px solid #007bff;
            }
            
            .job-row.closed {
                border-left-color: #dc3545;
            }
            
            .table-header {
                display: none;
            }
            
            .job-row > div::before {
                content: attr(data-label) ": ";
                font-weight: 600;
                color: #495057;
                display: inline-block;
                width: 120px;
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: 20px 10px;
            }
            
            .controls {
                flex-direction: column;
                align-items: stretch;
            }
            
            .control-group {
                justify-content: space-between;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>OpenAI Jobs Dashboard</h1>
            <p>San Francisco Bay Area Opportunities</p>
        </header>

        <div class="controls">
            <div class="control-group">
                <label for="sortBy">Sort by:</label>
                <select id="sortBy">
                    <option value="days_since_listed_desc">Days Since Listed (High to Low)</option>
                    <option value="days_since_listed_asc">Days Since Listed (Low to High)</option>
                    <option value="first_seen_desc">Date Listed (Newest)</option>
                    <option value="first_seen_asc">Date Listed (Oldest)</option>
                    <option value="title_asc">Job Title (A-Z)</option>
                    <option value="title_desc">Job Title (Z-A)</option>
                    <option value="team_asc">Team (A-Z)</option>
                    <option value="team_desc">Team (Z-A)</option>
                    <option value="department_asc">Department (A-Z)</option>
                    <option value="department_desc">Department (Z-A)</option>
                    <option value="salary_min_desc">Salary Min (High to Low)</option>
                    <option value="salary_min_asc">Salary Min (Low to High)</option>
                    <option value="salary_max_desc">Salary Max (High to Low)</option>
                    <option value="salary_max_asc">Salary Max (Low to High)</option>
                </select>
            </div>
            <div class="control-group">
                <label for="statusFilter">Show:</label>
                <select id="statusFilter">
                    <option value="ACTIVE" selected>Active Jobs Only</option>
                    <option value="all">All Jobs</option>
                    <option value="CLOSED">Closed Jobs Only</option>
                </select>
            </div>
        </div>

        <div class="stats" id="statsInfo">
            Loading...
        </div>

        <div class="jobs-table">
            <div class="table-header">
                <div>Date Listed</div>
                <div>Days</div>
                <div>Job Title</div>
                <div>Team</div>
                <div>Department</div>
                <div>Salary Min</div>
                <div>Salary Max</div>
                <div>Location</div>
                <div>Apply</div>
            </div>
            <div id="jobsList">
                <div class="loading">Loading jobs...</div>
            </div>
        </div>

        <div class="last-updated" id="lastUpdated"></div>
    </div>

    <script>
        let allJobs = [];
        let dashboardData = {};

        async function loadJobData() {
            try {
                const response = await fetch('./job_data/dashboard_data.json');
                dashboardData = await response.json();
                allJobs = [...dashboardData.active_jobs, ...dashboardData.closed_jobs];
                
                updateStats();
                filterAndDisplayJobs();
                updateLastUpdated();
                
            } catch (error) {
                console.error('Error loading job data:', error);
                document.getElementById('jobsList').innerHTML = `
                    <div class="no-results">
                        <h3>Unable to load job data</h3>
                        <p>Please make sure the dashboard data is available.</p>
                    </div>
                `;
            }
        }

        function updateStats() {
            const activeJobs = dashboardData.active_jobs || [];
            const closedJobs = dashboardData.closed_jobs || [];
            const statusFilter = document.getElementById('statusFilter').value;
            
            let displayCount = 0;
            if (statusFilter === 'all') displayCount = activeJobs.length + closedJobs.length;
            else if (statusFilter === 'ACTIVE') displayCount = activeJobs.length;
            else if (statusFilter === 'CLOSED') displayCount = closedJobs.length;
            
            document.getElementById('statsInfo').textContent = 
                `Showing ${displayCount} jobs (${activeJobs.length} active, ${closedJobs.length} recently closed)`;
        }

        function getSalaryValue(job, type) {
            if (!job.compensation || !job.compensation.summaryComponents) return 0;
            const salaryComp = job.compensation.summaryComponents.find(c => c.compensationType === 'Salary');
            if (!salaryComp) return 0;
            return type === 'min' ? (salaryComp.minValue || 0) : (salaryComp.maxValue || 0);
        }

        function formatSalary(amount) {
            if (!amount) return '-';
            return `$${Math.round(amount / 1000)}K`;
        }

        function getDaysBadgeClass(days) {
            if (days === 0) return 'days-new';
            if (days <= 7) return 'days-normal';
            return 'days-urgent';
        }

        function filterAndDisplayJobs() {
            const statusFilter = document.getElementById('statusFilter').value;
            const sortBy = document.getElementById('sortBy').value;

            let filteredJobs = allJobs.filter(job => {
                if (statusFilter === 'all') return true;
                return job.status === statusFilter;
            });

            // Sort jobs
            filteredJobs.sort((a, b) => {
                const [field, direction] = sortBy.split('_');
                let aVal, bVal;

                switch (field) {
                    case 'days':
                        aVal = a.days_since_listed || 0;
                        bVal = b.days_since_listed || 0;
                        break;
                    case 'first':
                        aVal = new Date(a.first_seen);
                        bVal = new Date(b.first_seen);
                        break;
                    case 'title':
                        aVal = a.title.toLowerCase();
                        bVal = b.title.toLowerCase();
                        break;
                    case 'team':
                        aVal = (a.team || '').toLowerCase();
                        bVal = (b.team || '').toLowerCase();
                        break;
                    case 'department':
                        aVal = (a.department || '').toLowerCase();
                        bVal = (b.department || '').toLowerCase();
                        break;
                    case 'salary':
                        const minMax = sortBy.includes('min') ? 'min' : 'max';
                        aVal = getSalaryValue(a, minMax);
                        bVal = getSalaryValue(b, minMax);
                        break;
                    default:
                        return 0;
                }

                if (direction === 'asc') {
                    return aVal > bVal ? 1 : aVal < bVal ? -1 : 0;
                } else {
                    return aVal < bVal ? 1 : aVal > bVal ? -1 : 0;
                }
            });

            displayJobs(filteredJobs);
            updateStats();
        }

        function displayJobs(jobs) {
            const container = document.getElementById('jobsList');
            
            if (jobs.length === 0) {
                container.innerHTML = `
                    <div class="no-results">
                        <h3>No jobs match your criteria</h3>
                        <p>Try adjusting your filters.</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = jobs.map(job => {
                const dateListedFormatted = new Date(job.first_seen).toLocaleDateString('en-US', {
                    month: 'short',
                    day: 'numeric',
                    year: 'numeric'
                });
                
                const daysClass = getDaysBadgeClass(job.days_since_listed || 0);
                const salaryMin = formatSalary(getSalaryValue(job, 'min'));
                const salaryMax = formatSalary(getSalaryValue(job, 'max'));
                const isActive = job.status === 'ACTIVE';
                
                return `
                    <div class="job-row ${job.status.toLowerCase()}">
                        <div class="date-listed" data-label="Date Listed">${dateListedFormatted}</div>
                        <div class="days-since ${daysClass}" data-label="Days">${job.days_since_listed || 0}</div>
                        <div class="job-title ${job.status.toLowerCase()}" data-label="Job Title">${job.title}</div>
                        <div class="team" data-label="Team">${job.team || '-'}</div>
                        <div class="department" data-label="Department">${job.department || '-'}</div>
                        <div class="salary" data-label="Salary Min">${salaryMin}</div>
                        <div class="salary" data-label="Salary Max">${salaryMax}</div>
                        <div class="location" data-label="Location">${job.location}</div>
                        <div data-label="Apply">
                            <a href="${job.applyUrl}" target="_blank" class="apply-link ${job.status.toLowerCase()}" 
                               ${isActive ? '' : 'onclick="return false;"'}>
                                ${isActive ? 'Apply' : 'Closed'}
                            </a>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function updateLastUpdated() {
            if (dashboardData.generated_at) {
                const date = new Date(dashboardData.generated_at);
                document.getElementById('lastUpdated').textContent = 
                    `Last updated: ${date.toLocaleString()}`;
            }
        }

        // Event listeners
        document.getElementById('sortBy').addEventListener('change', filterAndDisplayJobs);
        document.getElementById('statusFilter').addEventListener('change', filterAndDisplayJobs);

        // Load data when page loads
        loadJobData();
    </script>
</body>
</html>